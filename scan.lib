#!/bin/bash

source ./helper.lib

sublist3r_scan() {
    source $PATH_TO_SUBLIST3R/.venv/bin/activate
    python ${PATH_TO_SUBLIST3R}/sublist3r.py -d $line -o ${OUTPUT_DIR}/sublist3r_${line}
    deactivate
}

crtsh_scan() {
    echo $line
    bash $PATH_TO_CRTSH/crt.sh -d $line
    mv ${OUTPUT_DIR}/domain.${line}.txt ${OUTPUT_DIR}/crtsh_${line}
}

github_subdomains_scan() {
    $PATH_TO_GITHUB_SUBDOMAINS -d $line -t $GITHUB_TOKEN -raw > ${OUTPUT_DIR}/github-subdomains_$line
    rm ${line}.txt
}

dirsearch_scan() {
    source $PATH_TO_DIRSEARCH/.venv/bin/activate
    python $PATH_TO_DIRSEARCH/dirsearch.py -u $line -o ${OUTPUT_DIR}/dirsearch_${line}
    deactivate
}


scan() {
    case $TOOL in 
        sublist3r)
            sublist3r_scan
            ;;
        crtsh)
            crtsh_scan
            ;;
        github-subdomains)
            github_subdomains_scan
            ;;
        dirsearch)
            dirsearch_scan
            ;;
        *)
            sublist3r_scan &
            crtsh_scan &
            github_subdomains_scan &
            wait
            ;;
    esac
}

scan_domains_from_array() {
    for line in ${DOMAINS[@]}
    do
        scan
    done
}

scan_domains_from_file() {
    while IFS= read -r line || [ -n "$line" ]
    do
        scan
    done < $INPUT_FILE
}